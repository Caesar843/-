{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1>费用明细单</h1>
    
    <!-- 合同信息 -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title">合同信息</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>合同编号：</strong>{{ contract.id }}</p>
                    <p><strong>店铺：</strong>{{ contract.shop.name }}</p>
                    <p><strong>店铺地址：</strong>{{ contract.shop.address }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>租赁期限：</strong>{{ contract.start_date }} 至 {{ contract.end_date }}</p>
                    <p><strong>月租金：</strong>¥{{ contract.monthly_rent }}</p>
                    <p><strong>押金：</strong>¥{{ contract.deposit }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 费用汇总 -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title">费用汇总</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <p><strong>总费用：</strong>¥{{ summary.total_amount }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>已支付：</strong>¥{{ summary.paid_amount }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>未支付：</strong>¥{{ summary.unpaid_amount }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>支付率：</strong>{{ summary.payment_rate }}%</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 费用明细 -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title">费用明细</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>费用类型</th>
                        <th>金额</th>
                        <th>账单周期</th>
                        <th>状态</th>
                        <th>缴费方式</th>
                        <th>缴费时间</th>
                        <th>交易单号</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                    <tr>
                        <td>
                            {% if record.fee_type == 'RENT' %}租金
                            {% elif record.fee_type == 'PROPERTY_FEE' %}物业费
                            {% elif record.fee_type == 'UTILITY_FEE' %}水电费
                            {% elif record.fee_type == 'OTHER' %}其他费用
                            {% endif %}
                        </td>
                        <td>¥{{ record.amount }}</td>
                        <td>{{ record.billing_period_start }} 至 {{ record.billing_period_end }}</td>
                        <td>
                            {% if record.status == 'UNPAID' %}
                                <span class="badge bg-warning">未支付</span>
                            {% elif record.status == 'PAID' %}
                                <span class="badge bg-success">已支付</span>
                            {% elif record.status == 'VOID' %}
                                <span class="badge bg-danger">已作废</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if record.payment_method %}
                                {% if record.payment_method == 'WECHAT' %}微信支付
                                {% elif record.payment_method == 'ALIPAY' %}支付宝
                                {% elif record.payment_method == 'BANK_TRANSFER' %}银行转账
                                {% elif record.payment_method == 'CASH' %}现金
                                {% endif %}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ record.paid_at|default:"-" }}</td>
                        <td>{{ record.transaction_id|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 操作按钮 -->
    <div class="mb-4">
        <a href="{% url 'finance:finance_list' %}" class="btn btn-secondary">返回列表</a>
        <button onclick="window.print()" class="btn btn-primary">打印明细单</button>
    </div>
</div>
{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/ui-tokens.css' %}">
<link rel="stylesheet" href="{% static 'css/ui-components.css' %}">
<link rel="stylesheet" href="{% static 'css/communication-management.css' %}">
{% endblock %}

{% block content %}
<div class="container comm-page">
    <div class="comm-header">
        <div class="comm-title-wrap">
            <span class="comm-title-bar"></span>
            <div>
                <div class="comm-title">&#x6D3B;&#x52A8;&#x7533;&#x8BF7;&#x7BA1;&#x7406;</div>
                <div class="comm-subtitle">&#x5E97;&#x94FA;&#x6D3B;&#x52A8;&#x7533;&#x8BF7;&#x4E0E;&#x5BA1;&#x6838;&#x8FDB;&#x5EA6;&#x4E00;&#x89C8;</div>
            </div>
        </div>
        {% if user.profile.role.role_type == 'SHOP' %}
        <div class="comm-actions">
            <a href="{% url 'communication:activity_create' %}" class="ui-btn ui-btn-primary">
                <i class="fas fa-plus"></i> &#x63D0;&#x4EA4;&#x6D3B;&#x52A8;&#x7533;&#x8BF7;
            </a>
        </div>
        {% endif %}
    </div>

    <div class="ui-card ui-section comm-table-card">
        <div class="table-responsive">
            <table class="ui-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>&#x5E97;&#x94FA;</th>
                        <th>&#x6807;&#x9898;</th>
                        <th>&#x7C7B;&#x578B;</th>
                        <th>&#x72B6;&#x6001;</th>
                        <th>&#x5F00;&#x59CB;&#x65E5;&#x671F;</th>
                        <th>&#x7ED3;&#x675F;&#x65E5;&#x671F;</th>
                        <th>&#x64CD;&#x4F5C;</th>
                    </tr>
                </thead>
                <tbody>
                    {% for application in applications %}
                    <tr>
                        <td>{{ application.id }}</td>
                        <td>{{ application.shop.name }}</td>
                        <td>{{ application.title }}</td>
                        <td>{{ application.get_activity_type_display }}</td>
                        <td>
                            <span class="status-badge {% if application.status == 'PENDING' %}warning{% elif application.status == 'APPROVED' %}success{% elif application.status == 'REJECTED' %}danger{% else %}neutral{% endif %}">
                                {{ application.get_status_display }}
                            </span>
                        </td>
                        <td>{{ application.start_date|date:"Y-m-d H:i" }}</td>
                        <td>{{ application.end_date|date:"Y-m-d H:i" }}</td>
                        <td>
                            <a href="{% url 'communication:activity_detail' application.id %}" class="ui-btn ui-btn-info ui-btn-sm">&#x67E5;&#x770B;</a>
                            {% if user.is_superuser or user.profile.role.role_type == 'ADMIN' %}
                                {% if application.status == 'PENDING' %}
                                <a href="{% url 'communication:activity_review' application.id %}" class="ui-btn ui-btn-primary ui-btn-sm">&#x5BA1;&#x6838;</a>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="ui-text-muted text-center">&#x6682;&#x65E0;&#x6D3B;&#x52A8;&#x7533;&#x8BF7;</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/ui-tokens.css' %}">
<link rel="stylesheet" href="{% static 'css/ui-components.css' %}">
<link rel="stylesheet" href="{% static 'css/communication-management.css' %}">
{% include 'partials/modern_theme.html' %}
<style>
    .request-form-grid {
        display: grid;
        gap: 16px;
    }

    .request-form-grid label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--ops-muted);
        font-weight: 600;
    }

    .request-form-grid input,
    .request-form-grid select,
    .request-form-grid textarea {
        border-radius: var(--ops-radius-md);
        border: 1px solid var(--ops-border);
        padding: 10px 12px;
        font-size: 14px;
        background: var(--input-bg);
        color: var(--input-text);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .request-form-grid textarea {
        min-height: 120px;
        resize: vertical;
    }

    .request-form-grid input:focus,
    .request-form-grid select:focus,
    .request-form-grid textarea:focus {
        border-color: var(--input-focus);
        box-shadow: 0 0 0 0.2rem var(--focus-ring);
        outline: none;
    }

    .request-section {
        padding: 16px;
        border-radius: var(--ops-radius-lg);
        border: 1px solid var(--ops-border);
        background: var(--surface-2);
    }
</style>
{% endblock %}

{% block content %}
<div class="container page-shell">
    {% include 'partials/page_header.html' with title="提交申请" subtitle="选择类型并填写申请内容" %}
    <div class="ui-card ui-section">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {% if form.non_field_errors %}
            <div class="ui-alert ui-alert-warning mb-3">
                {{ form.non_field_errors }}
            </div>
            {% endif %}
            <div class="request-form-grid">
                <div>
                    <label for="id_kind">申请类型</label>
                    {{ form.kind }}
                </div>
                <div>
                    <label for="id_title">标题</label>
                    {{ form.title }}
                </div>
                <div>
                    <label for="id_description">描述</label>
                    {{ form.description }}
                </div>
                <div>
                    <label for="id_attachment">附件（可选）</label>
                    {{ form.attachment }}
                </div>
            </div>

            <div class="request-section mt-3" id="maintenanceFields">
                <div class="request-form-grid">
                    <div>
                        <label for="id_request_type">维修类型</label>
                        {{ form.request_type }}
                    </div>
                    <div>
                        <label for="id_priority">优先级</label>
                        {{ form.priority }}
                    </div>
                </div>
            </div>

            <div class="request-section mt-3" id="activityFields">
                <div class="request-form-grid">
                    <div>
                        <label for="id_activity_type">活动类型</label>
                        {{ form.activity_type }}
                    </div>
                    <div>
                        <label for="id_start_date">开始时间</label>
                        {{ form.start_date }}
                    </div>
                    <div>
                        <label for="id_end_date">结束时间</label>
                        {{ form.end_date }}
                    </div>
                    <div>
                        <label for="id_location">场地位置</label>
                        {{ form.location }}
                    </div>
                    <div>
                        <label for="id_participants">参与人数</label>
                        {{ form.participants }}
                    </div>
                </div>
            </div>

            <div class="mt-3 d-flex gap-2">
                <button type="submit" class="ui-btn ui-btn-primary">提交申请</button>
                <a href="{% url 'communication:request_list' %}" class="ui-btn ui-btn-outline">取消</a>
            </div>
        </form>
    </div>
</div>

<script>
    const kindSelect = document.getElementById('id_kind');
    const maintenanceFields = document.getElementById('maintenanceFields');
    const activityFields = document.getElementById('activityFields');

    function toggleFields() {
        const kind = kindSelect.value;
        if (kind === 'activity') {
            activityFields.style.display = 'block';
            maintenanceFields.style.display = 'none';
        } else {
            activityFields.style.display = 'none';
            maintenanceFields.style.display = 'block';
        }
    }

    if (kindSelect) {
        toggleFields();
        kindSelect.addEventListener('change', toggleFields);
    }
</script>
{% endblock %}

{% extends 'base.html' %}

{% block title %}æ•°æ®åˆ†æ - å•†åœºåº—é“ºæ™ºèƒ½è¿è¥ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mt-4 mb-4">ğŸ“ˆ æ•°æ®åˆ†æ</h1>

        <!-- åˆ†æç»“æœåˆ—è¡¨ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">åˆ†æç»“æœ</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>åº—é“º</th>
                                <th>åˆ†æå‘¨æœŸ</th>
                                <th>åˆ†ææ—¶é—´</th>
                                <th>å®¢æµé‡</th>
                                <th>é”€å”®é¢</th>
                                <th>å®¢å•ä»·</th>
                                <th>è½¬åŒ–ç‡</th>
                                <th>é”€å”®å¢é•¿ç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for analysis in analyses %}
                            <tr>
                                <td>{{ analysis.shop.name }}</td>
                                <td>{{ analysis.get_analysis_period_display }}</td>
                                <td>{{ analysis.analyzed_at|date:'Y-m-d H:i' }}</td>
                                <td>{{ analysis.total_foot_traffic }}</td>
                                <td>Â¥{{ analysis.total_sales|floatformat:2 }}</td>
                                <td>Â¥{{ analysis.average_transaction_value|floatformat:2 }}</td>
                                <td>{{ analysis.conversion_rate|floatformat:2 }}%</td>
                                <td>{{ analysis.sales_growth_rate|floatformat:2 }}%</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- åº—é“ºåˆ†æé€‰æ‹© -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">åº—é“ºåˆ†æ</h5>
            </div>
            <div class="card-body">
                <form method="get" action="{% url 'operations:analysis' %}">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="shop" class="form-label">åº—é“º</label>
                            <select class="form-select" id="shop" name="shop">
                                <option value="">å…¨éƒ¨åº—é“º</option>
                                {% for shop in shops %}
                                <option value="{{ shop.id }}">{{ shop.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="period" class="form-label">åˆ†æå‘¨æœŸ</label>
                            <select class="form-select" id="period" name="period">
                                <option value="daily">æ—¥</option>
                                <option value="weekly">å‘¨</option>
                                <option value="monthly">æœˆ</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">æŸ¥çœ‹åˆ†æ</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}